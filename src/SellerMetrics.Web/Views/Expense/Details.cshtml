@model ExpenseDetailViewModel

<div class="row">
    <!-- Main Details -->
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-receipt-cutoff me-2"></i>Expense Details
                </h5>
                <div class="btn-group">
                    <a asp-action="Edit" asp-route-id="@Model.Expense.Id" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-pencil me-1"></i>Edit
                    </a>
                    <button type="button" class="btn btn-outline-danger btn-sm"
                            data-bs-toggle="modal" data-bs-target="#deleteModal">
                        <i class="bi bi-trash me-1"></i>Delete
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label text-muted small">Expense Date</label>
                            <p class="mb-0 fs-5">@Model.Expense.ExpenseDate.ToString("MMMM d, yyyy")</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label text-muted small">Amount</label>
                            <p class="mb-0 fs-4 fw-bold">@Model.Expense.AmountFormatted</p>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-3">
                            <label class="form-label text-muted small">Description</label>
                            <p class="mb-0 fs-5">@Model.Expense.Description</p>
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.Expense.Vendor))
                    {
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Vendor</label>
                                <p class="mb-0">@Model.Expense.Vendor</p>
                            </div>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.Expense.ReferenceNumber))
                    {
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">Reference Number</label>
                                <p class="mb-0">@Model.Expense.ReferenceNumber</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Tax Information -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0">
                    <i class="bi bi-file-earmark-text me-2"></i>Tax Information
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">Schedule C Category</small>
                            <span class="fw-semibold">@Model.Expense.CategoryDisplay</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded">
                            <small class="text-muted d-block">Schedule C Line</small>
                            <span class="fw-semibold">Line @Model.Expense.ScheduleCLine</span>
                            <small class="d-block text-muted">@Model.Expense.ScheduleCLineLabel</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3 @(Model.Expense.IsTaxDeductible ? "bg-success" : "bg-warning") bg-opacity-10 rounded">
                            <small class="text-muted d-block">Tax Deductible</small>
                            @if (Model.Expense.IsTaxDeductible)
                            {
                                <span class="fw-semibold text-success">
                                    <i class="bi bi-check-circle me-1"></i>Yes
                                </span>
                            }
                            else
                            {
                                <span class="fw-semibold text-warning">
                                    <i class="bi bi-x-circle me-1"></i>No
                                </span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes -->
        @if (!string.IsNullOrEmpty(Model.Expense.Notes))
        {
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="mb-0">
                        <i class="bi bi-sticky me-2"></i>Notes
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-0">@Model.Expense.Notes</p>
                </div>
            </div>
        }
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Business Line -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0">
                    <i class="bi bi-building me-2"></i>Business Line
                </h6>
            </div>
            <div class="card-body">
                @{
                    var lineClass = Model.Expense.BusinessLine switch
                    {
                        BusinessLine.eBay => "bg-primary",
                        BusinessLine.ComputerServices => "bg-success",
                        BusinessLine.Shared => "bg-info",
                        _ => "bg-secondary"
                    };
                }
                <span class="badge @lineClass fs-6">@Model.Expense.BusinessLineDisplay</span>
                <p class="text-muted small mt-2 mb-0">
                    @switch (Model.Expense.BusinessLine)
                    {
                        case BusinessLine.eBay:
                            @:This expense is allocated to eBay reselling.
                            break;
                        case BusinessLine.ComputerServices:
                            @:This expense is allocated to computer services.
                            break;
                        case BusinessLine.Shared:
                            @:This expense will be proportionally allocated between business lines.
                            break;
                    }
                </p>
            </div>
        </div>

        <!-- Receipt -->
        @if (!string.IsNullOrEmpty(Model.Expense.ReceiptPath))
        {
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0">
                        <i class="bi bi-file-image me-2"></i>Receipt
                    </h6>
                </div>
                <div class="card-body">
                    <a href="@Model.Expense.ReceiptPath" target="_blank" class="btn btn-outline-primary w-100">
                        <i class="bi bi-eye me-1"></i>View Receipt
                    </a>
                </div>
            </div>
        }

        <!-- Service Job Link -->
        @if (Model.Expense.ServiceJobId.HasValue)
        {
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0">
                        <i class="bi bi-tools me-2"></i>Linked Service Job
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-0">
                        Job: <strong>@(Model.Expense.ServiceJobNumber ?? $"#{Model.Expense.ServiceJobId}")</strong>
                    </p>
                </div>
            </div>
        }

        <!-- Timeline -->
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h6 class="mb-0">
                    <i class="bi bi-clock-history me-2"></i>Timeline
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="d-flex mb-3">
                        <div class="me-3">
                            <span class="badge bg-primary rounded-pill"><i class="bi bi-plus"></i></span>
                        </div>
                        <div>
                            <strong>Logged</strong>
                            <p class="text-muted mb-0 small">@Model.Expense.CreatedAt.ToString("MMM d, yyyy 'at' h:mm tt")</p>
                        </div>
                    </li>
                    @if (Model.Expense.UpdatedAt.HasValue)
                    {
                        <li class="d-flex">
                            <div class="me-3">
                                <span class="badge bg-secondary rounded-pill"><i class="bi bi-pencil"></i></span>
                            </div>
                            <div>
                                <strong>Last Updated</strong>
                                <p class="text-muted mb-0 small">@Model.Expense.UpdatedAt.Value.ToString("MMM d, yyyy 'at' h:mm tt")</p>
                            </div>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Expense</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this expense?</p>
                <p class="text-danger mb-0">
                    <i class="bi bi-exclamation-triangle me-1"></i>This action cannot be undone.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form asp-action="Delete" asp-route-id="@Model.Expense.Id" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i>Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
